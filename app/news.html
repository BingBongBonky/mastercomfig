<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="node_modules/xel/themes/material.css">
  <script src="node_modules/xel/xel.min.js"></script>
  <link href="node_modules/bootstrap/dist/css/bootstrap.min.css"
        integrity="sha256-zVUlvIh3NEZRYa9X/qpNY8P1aBy0d4FrI7bhfZSZVwc="
        crossorigin="anonymous" rel="stylesheet">
  <link href="third_party/font/overpass.css" rel="stylesheet">
  <link href="css/app.css" rel="stylesheet">
  <title>mastercomfig</title>
</head>
<body class="bg-light">
<nav class="navbar navbar-dark bg-dark d-flex align-items-center sticky-top"
     style="-webkit-app-region: drag; border-bottom: 1px solid #141414">
  <a href="#" id="slider-toggle">
    <x-icon name="menu" skin="titlebar"
            style="-webkit-app-region: no-drag"></x-icon>
  </a>
  <span class="navbar-brand">
    <img src="img/mastercomfig_logo_transparent.png" style="width: 30px;
    height: 30px" class="d-inline-block align-top" alt="">
    mastercomfig
  </span>
  <a href="#">
    <x-icon name="close" skin="titlebar" style="-webkit-app-region: no-drag"
            id="close-btn"></x-icon>
  </a>
</nav>
<ul class="nav flex-column position-fixed bg-dark text-light" id="slider"
    style="width:
30%; height: 100vh; z-index: 1000; left: -30%; border-right: 1px solid
#141414">
  <li class="nav-item" style="margin-top: 1rem;">
    <a class="nav-link no-link" href="mastercomfig.html">
      <x-icon
        name="home"></x-icon>
      Home</a>
  </li>
  <hr>
  <li class="nav-item">
    <a class="nav-link no-link" href="community.html">
      <x-icon
        name="share"></x-icon>
      Community</a>
  </li>
  <hr>
  <li class="nav-item">
    <a class="nav-link no-link" href="settings.html">
      <x-icon
        name="settings"></x-icon>
      Settings</a>
  </li>
  <hr>
  <li class="nav-item">
    <a class="nav-link no-link active" href="news.html">
      <x-icon
        name="rss-feed"></x-icon>
      News</a>
  </li>
  <hr>
  <li class="nav-item">
    <a class="nav-link no-link" href="about.html">
      <x-icon
        name="info"></x-icon>
      About</a>
  </li>
  <hr>
</ul>
<div class="container" id="content"
     style="overflow-y: scroll; overflow-x: hidden; height: 90vh;
     padding-bottom: 48px;">
  <x-throbber class="mx-auto align-middle"
              style="margin-top: 35vh"></x-throbber>
</div>
<x-notification id="error-notification" timeout="4000">
  An error occurred. Please try again later.
</x-notification>
<script src="js/module.js"></script>
<script src="node_modules/jquery/dist/jquery.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script src="node_modules/popper.js/dist/umd/popper.js"
        integrity="sha256-wqAoCRn9//AnHSl4qbXVhqdvmgFQqN5Elqp4Eb2wOXA="
        crossorigin="anonymous"></script>
<script src="node_modules/bootstrap/dist/js/bootstrap.min.js"
        integrity="sha256-IeI0loa35pfuDxqZbGhQUiZmD2Cywv1/bdqiypGW46o="
        crossorigin="anonymous"></script>
<script src="js/lib.js"></script>
<script src="js/titlebar.js"></script>
<script src="js/dark.js"></script>
<script>
  "use strict";

  $(() => {
    page();
  });

  function page() {
    if (visitor) {
      visitor.screenview("News").send();
    }

    firebase.auth().signInAnonymously().catch(function(error) {
      // ignored
    });

    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        var content = document.getElementById("content");

        if (visitor) {
          visitor.set("uid", user.uid);
        }

        db.collection("news").orderBy("date", "desc").get().then(snapshot => {
          content.innerHTML = "";
          snapshot.forEach(doc => {
            var post = doc.data();
            var card = document.createElement("x-card");
            var header = document.createElement("header");
            var title = document.createElement("h3");
            title.innerText = post.name;
            var author = document.createElement("h6");
            author.innerText = "by " + post.author;
            header.appendChild(title);
            title.appendChild(author);
            var date = document.createElement("h6");
            date.innerText = "posted " + post.date.toDate().toDateString();
            title.appendChild(date);
            card.appendChild(header);
            var main = document.createElement("main");
            var article = document.createElement("p");
            article.innerText = post.contents.replaceAll("\\n", "\n");
            main.appendChild(article);
            card.appendChild(main);
            content.appendChild(card);
          });
        });
      } else {
        // failed, ignored for now
      }
    });
  }
</script>
</body>
</html>
